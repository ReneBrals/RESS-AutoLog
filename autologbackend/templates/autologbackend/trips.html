{% extends 'autologbackend/base.html' %}
{% load extras %}
{% block content %}
<h3> Logged trips </h3>
<form action="{% url 'trips' 0 %}" method="GET">
    <div class="row">
        <div class="col-lg-3">
            <div class="input-group">
                <span class="input-group-addon" id="basic-addon1">Vehicle</span>
                <input type="text" class="form-control" id="basic-url" aria-describedby="basic-addon1" name="vehicle" {% if request.GET.vehicle %} value="{{ request.GET.vehicle }}" {% endif %}>
            </div>
        </div>
        <div class="col-lg-3">
            <div class="input-group">
                <span class="input-group-addon" id="basic-addon1">Driver</span>
                <input type="text" class="form-control" id="basic-url" aria-describedby="basic-addon1" name="driver" {% if request.GET.driver %} value="{{ request.GET.driver }}" {% endif %}>
            </div>
        </div>
    </div>
    <br/>
    <div class="row">
        <div class="col-lg-6">
            <div class="input-group">
                <span class="input-group-addon" id="basic-addon1">Distance</span>
                <input type="number" class="form-control" id="basic-url" aria-describedby="basic-addon1" placeholder="min. distance" name="min_dist" {% if request.GET.min_dist %} value="{{ request.GET.min_dist }}" {% endif %}>
                <span class="input-group-addon" aria-describedby="basic-addon1"> - </span>
                <input type="number" class="form-control" id="basic-url" aria-describedby="basic-addon1" placeholder="max. distance" name="max_dist" {% if request.GET.max_dist %} value="{{ request.GET.max_dist }}" {% endif %}>
            </div>
        </div>

        <div class="col-lg-6">
            <div class="input-group">
                <span class="input-group-addon" id="basic-addon1">Date Range</span>
                <input type='text' class="form-control" name="begin_date" id="begin_date" aria-describedby="basic-addon1" {% if request.GET.begin_date %} value="{{ GET_stuff.begin_date }}" {% endif %}/>
                <span class="input-group-addon" aria-describedby="basic-addon1"> - </span>
                <input type="text" class="form-control" name="end_date" id="end_date" aria-describedby="basic-addon1"  {% if request.GET.end_date %} value="{{ GET_stuff.end_date }}" {% endif %}>
            </div>
        </div>
    </div>
    <br/>
    <div class="row">
        <div class="col-lg-6">
            <div class="input-group">
                <span class="input-group-addon" id="basic-addon1">From Location</span>
                <input type="text" class="form-control" id="basic-url" aria-describedby="basic-addon1" name="departure_location" {% if request.GET.departure_location %} value="{{ request.GET.departure_location }}" {% endif %}>
                <span class="input-group-addon">Within</span>
                <input type="number" class="form-control" id="basic-url" aria-describedby="basic-addon1" name="fromrange" {% if request.GET.fromrange %} value="{{ request.GET.fromrange }}" {% endif %}>
                <span class="input-group-addon">km</span>
            </div>
        </div>
        <div class="col-lg-6">
            <div class="input-group">
                <span class="input-group-addon" id="basic-addon1">To Location</span>
                <input type="text" class="form-control" id="basic-url" aria-describedby="basic-addon1" name="arrival_location" {% if request.GET.arrival_location %} value="{{ request.GET.arrival_location }}" {% endif %}>
                <span class="input-group-addon">Within</span>
                <input type="number" class="form-control" id="basic-url" aria-describedby="basic-addon1" name="torange" {% if request.GET.torange %} value="{{ request.GET.torange }}" {% endif %}>
                <span class="input-group-addon">km</span>
            </div>
        </div>
    </div>
    <br/>
    <button type="submit" class="btn btn-success">Filter</button>

    <a href="{%url 'trips' 0 %}" class="btn btn-warning"> Clear Filters</a>
    <a href="{%url 'log_trip' %}" class="btn btn-primary"> Log a Trip</a>

</form>

<nav aria-label="Page navigation">
  <ul class="pagination">
    <li>
      <a href="{% url 'trips' prev_page_nr %}{% GET_string %}" aria-label="Previous">
        <span aria-hidden="true">&laquo;</span>
      </a>
    </li>
    {% if num_pages > 5 %}
    <li><a href="{% url 'trips' 0 %}{% GET_string %}">1</a></li>
    <li><a href="{% url 'trips' 1 %}{% GET_string %}">2</a></li>
    <li><a href="{% url 'trips' 2 %}{% GET_string %}">3</a></li>

    <li><a href="{% url 'trips' num_pages|add:"-2" %}{% GET_string %}">{{ num_pages|add:"-1" }}</a></li>
    <li><a href="{% url 'trips' num_pages|add:"-1" %}{% GET_string %}">{{ num_pages }}</a></li>
    {% else %}
    {% with ''|center:num_pages as range %}
    {% for _ in range %}
        <li><a href="{% url 'trips' forloop.counter0 %}{% GET_string %}">{{ forloop.counter }}</a></li>
    {% endfor %}
    {% endwith %}
    {% endif %}
    <li>
        <a href="{% url 'trips' next_page_nr %}{% GET_string %}" aria-label="Next">
            <span aria-hidden="true">&raquo;</span>
        </a>
    </li>
  </ul>
</nav>

<br/>

{% if trips_list %}

    <table class="table table-striped">
		<tr>
    		<th>Vehicle</th>
    		<td></td>
    		<th>Driver</th> 
    		<th>From</th>
            <th></th>
            <th>To</th>
            <th></th>
            <th>Distance</th>
            <th>Mileage dep.</th>
    		<th>Mileage arr.</th>
            <th></th>
  		</tr>

    	{% for trip in trips_list %}
    	<tr>
    	<td><a href="{% url 'vehicle_detail' trip.vehicle.id %}">{{ trip.vehicle.license_plate }}</a></td>
    	<td>{{ trip.vehicle.vehicle_make }} {{ trip.vehicle.vehicle_model }}</td>
    	<td><a href="{% url 'driver_detail' trip.driver.id %}">{{ trip.driver.name }}</td>
    	<td>{{ trip.departure_location.description }}</td>
        <td>{{ trip.departure_time }}</td>
        
        <td>{{ trip.arrival_location.description }}</td>
        <td>{{ trip.arrival_time }}</td>
        <td>{{ trip.distance }} {{ trip.vehicle.mileage_unit }}</td>
    	<td>{{ trip.departure_mileage }} {{ trip.vehicle.mileage_unit }}</td>
    	<td>{{ trip.arrival_mileage }} {{ trip.vehicle.mileage_unit }}</td>
        <td>
        <a href="{% url 'edit_trip' trip.pk %}"><span class="glyphicon glyphicon-pencil" aria-hidden="true"></span></a>
        <a onclick='bootbox.confirm("Are you sure you want to delete this entry?", function(result){if(result){confirmbox("{% url 'delete_trip' trip.pk %}")}})'>
            <span class="glyphicon glyphicon-floppy-remove" aria-hidden="true"></span>
        </a>
        </td>

    	</tr>
    	{% endfor %}
    </table>
{% else %}
    <p>No trips are available.</p>
{% endif %}

<nav aria-label="Page navigation">
  <ul class="pagination">
    <li>
      <a href="{% url 'trips' prev_page_nr %}" aria-label="Previous">
        <span aria-hidden="true">&laquo;</span>
      </a>
    </li>
    {% if num_pages > 5 %}
    <li><a href="{% url 'trips' 0 %}">1</a></li>
    <li><a href="{% url 'trips' 1 %}">2</a></li>
    <li><a href="{% url 'trips' 2 %}">3</a></li>

    <li><a href="{% url 'trips' num_pages|add:"-2" %}">{{ num_pages|add:"-1" }}</a></li>
    <li><a href="{% url 'trips' num_pages|add:"-1" %}">{{ num_pages }}</a></li>
    {% else %}
    {% with ''|center:num_pages as range %}
    {% for _ in range %}
        <li><a href="{% url 'trips' forloop.counter0 %}">{{ forloop.counter }}</a></li>
    {% endfor %}
    {% endwith %}
    {% endif %}
    <li>
        <a href="{% url 'trips' next_page_nr %}" aria-label="Next">
            <span aria-hidden="true">&raquo;</span>
        </a>
    </li>
  </ul>
</nav>

<script type="text/javascript">
$(document).ready(function() {
    $(function () {
        $("#begin_date").datetimepicker({
            useCurrent: false,
            format: "DD-MM-YYYY",
            calendarWeeks: true });
        $("#end_date").datetimepicker({
            useCurrent: false,
            format: "DD-MM-YYYY",
            calendarWeeks: true });

        $("#begin_date").on("dp.change", function (e) {
            $("#end_date").data("DateTimePicker").minDate(e.date);
        });

        $("#end_date").on("dp.change", function (e) {
            $("#begin_date").data("DateTimePicker").maxDate(e.date);
        });
    });
});
</script>

{% endblock %}